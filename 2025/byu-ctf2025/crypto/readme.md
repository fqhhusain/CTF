## ChooseYourRsa

```
import json
from Crypto.Util.number import long_to_bytes
from pwn import *
from json import dumps, loads
from Crypto.Util.number import *
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import gmpy2
from sympy.ntheory.modular import crt

conn = remote('choose.chal.cyberjousting.com', 1348)

data = conn.recvuntil(b"order.")
print(data.decode())

encrypted_flag_hex = None
for line in data.decode().split('\n'):
    if len(line) > 20 and all(c in "0123456789abcdef" for c in line.strip()):
        encrypted_flag_hex = line.strip()
        print(f"Captured encrypted flag: {encrypted_flag_hex}")

e_values = "2 3 6"
print(f"Sending e values: {e_values}")
conn.sendline(e_values.encode())

n_values = []
c_values = []

response = conn.recvall().decode().strip()
print("Full response:")
print(response)

lines = response.split('\n')
for line in lines:
    line = line.strip()
    if line.startswith('n'):
        try:
            n_value = int(line.split('=')[1])
            n_values.append(n_value)
            print(f"Parsed n: {n_value}")
        except:
            print(f"Failed to parse: {line}")
    elif line.startswith('c'):
        try:
            c_value = int(line.split('=')[1])
            c_values.append(c_value)
            print(f"Parsed c: {c_value}")
        except:
            print(f"Failed to parse: {line}")

print(f"Received {len(n_values)} n values and {len(c_values)} c values")


d_values = []

with open("rsa_values.txt", "w") as f:
    f.write(f"Encrypted flag (hex): {encrypted_flag_hex}\n\n")
    f.write(f"e values: {e_values}\n\n")
    for i in range(len(n_values)):
        f.write(f"n[{i}] = {n_values[i]}\n")
        f.write(f"c[{i}] = {c_values[i]}\n\n")

factor ={2, 3, 6}
val_lcm = 6
factor = list(factor) 

for i in range(len(n_values)):
    d_values.append(pow(c_values[i], val_lcm // factor[i], n_values[i]))

    print(f"Decrypted d value for n[{i}]: {d_values[i]}")
    
print(f"Values saved to rsa_values.txt")

conn.close()
```
Hastag Broadcast
```
from sage.all import ZZ
import os
import sys
from math import gcd


path = os.path.dirname(os.path.dirname(os.path.dirname(os.path.realpath(os.path.abspath(__file__)))))
if sys.path[1] != path:
    sys.path.insert(1, path)

from sage.all import crt
from math import lcm

def low_exponent(e, c):
    """
    Recovers the plaintext from a ciphertext, encrypted using a very small public exponent (e.g. e = 3).
    :param e: the public exponent
    :param c: the ciphertext
    :return: the plaintext
    """
    return int(ZZ(c).nth_root(e))

def fast_crt(X, M, segment_size=8):
    """
    Uses a divide-and-conquer algorithm to compute the CRT remainder and least common multiple.
    :param X: the remainders
    :param M: the moduli (not necessarily coprime)
    :param segment_size: the minimum size of the segments (default: 8)
    :return: a tuple containing the remainder and the least common multiple
    """
    assert len(X) == len(M)
    assert len(X) > 0
    while len(X) > 1:
        X_ = []
        M_ = []
        for i in range(0, len(X), segment_size):
            if i == len(X) - 1:
                X_.append(X[i])
                M_.append(M[i])
            else:
                X_.append(crt(X[i:i + segment_size], M[i:i + segment_size]))
                M_.append(lcm(*M[i:i + segment_size]))
        X = X_
        M = M_

    return X[0], M[0]

def attack(N, e, c):
    """
    Recovers the plaintext from e ciphertexts, encrypted using different moduli and the same public exponent.
    :param N: the moduli
    :param e: the public exponent
    :param c: the ciphertexts
    :return: the plaintext
    """

    for i in range(len(N)):
        for j in range(len(N)):
            if i != j and gcd(N[i], N[j]) != 1:
                raise ValueError(f"Modulus {i} and {j} share factors, Hastad's attack is impossible.")

    c, _ = fast_crt(c, N)
    return low_exponent(e, c)


e = 6
n1=16621945106468041097867017128258061985161684266628591974089631780012186142545066614435718612274001094061398506943430547805692069126822660335098574660544841058315935568808883844601917199067303328516271330418556505199612587907740031253974055570622577502951110615120695361477056082358951621888482380263545996283368132258384926161683389251330507741728302348960481824820743296563005896215435298942487330206150973115444735263607700533010848382283944556220703518677937725045605697023817924980519596472615788046205113076173851952445857077984501192641970238853970366896300192315678528239813148769577601393910592516002311390611
n2=2151787033579864466956646795925856280006571862014613626188738234335185965901065827391228676536555829996485130154615054438141541221101704857910441585441190965260980891964610030658390210450153831768645648952704584899718702213411114537576740766011525639993408109804265755988332594440632292328540678232487187192172861282143724217598405626680068831683839162725247680018158228282904131154826375343430883685463148646956160388537663371819298252068376208707578801242987503555320600457934701287764428383200226320141550366928043905435202083974783258172904498465069124687341775247240234008518293974506048597455233164767695173305165378163723959781032792795902052342166460480376482472717616898204823694661700142988578219166275300681764568303588824088256739300533680086302937065670806234590604787195778830669568351489686546173063556158496943762861118409242990160122073809491081939572068522895000623233387588019713224503749030650238196040239
n3=713937582206711723460218935738556895461693000235466428968893706743399392588672978434247905421609789502529331012485703618262666225157523779043072087576740748298421977106599501987608632923372704889869484991195523282771290368235775916427790755778883569702289819291084571425936357188501082309633151073325865208109835107655040516359659903995800175994481259885837409956127558707937417821273890163894715232343947006696625216574031252237202317808793051531208534524115950288984437435823619813928421557562147108667291663940375498807054237250369768765777605217473521292433026216824260486572243128918700444163794577233602391710288795263402375426125364997741308729603389127822825653260196031603791432549625968615327418815842628342913806704121865545759142405583359506010122082636475669481538226334142488303395694385553655401229699099363960010364736027646825089730151973633344950635051949830303133919050548188515105681165862922515812255125823554495164724440734917214338975551640942650048616969733243571318921988780191899935070800520304567141078782717002216581174446689204873873651388621920478506044496629102336694974509540895201410715807707670465498361427818018117261476854212020900675627907275882423189271615778287730680424594303178336649878299643

c1= 14955737408373846566518064218976691297569733856173002790495241020289583468295170283961859389110007704538791908828820013697814801253778264056474891172013011708903119388921813660045088310191290580885597478132288102564190532298783198665963255358447221416923780961226322416777217574830193079906833453095673040755919468261401797671395219846112671563106442667830915957703359882749445050440050043065929022925634656582573001175051620824751133836695031200808600090919394208201146632796085104515413683460626768861779997237891844327905931728553766563362352539681168145404419963591408607702407467590357384379042967509841249192488
c2= 141002658959569575127699949953190296844739099068623452913032466331491741624261023391850103045901227997206092459565605856262511202671481550020510340792238623118630194212358250345292239167489040792863409122784078080728565989896907685681924566776736725616331735704211653263933433920568761382630126279698779413419302448120060761136976123234617017503842878104755309298691667785883951927008908256316481270984606487240651538773605007596604556449630532405549048632903507487310067116815488604542039302652170319141663631622800394592133242114727686769179974792866710357192279561333801184052526829748439267010395082051124518067378708873955919182928848691856340383346456930595568301899256608068847870674127207446688483419249381252126744350286186577824850434444309870692953691656404985864892105544164820189541729400466818875685062770664615277086741049407279003269967193423167473695882457833144635570201449978921193977459140380692278431855
c3 =373334046180785059633180551120028615708585540355164293503914661174377675675647772516529953662355236664920519145981538204951878270611230672655374844565017204258556492058995004724443551276307694379806563907019699035245756964653613670687797616348626181512781340642496297905184761379488718753892422744081537233330494682175113130302947845084202457226664255392434156411872757191147952923156597854359792057629505948411600773600773032483688480387041281862747258279200750712515283599662486864863304882465714751607634576373431015984488938168234498868802794241947395304246617209068827352482199041878402201091791251738714810681608773598628828467276655309671961905915558274560865664135306620504194033814535977500531886743946376767707861900102912321746488076323998458844408307964169127703126270779188880490466007856938965025902368520993776446014216187323350162961987171747648613407637324278931815454241032205458049433793466247983911608529472581814090543760204131710953800282432366827713108533681058416089721270429529943352177383467654186019757349498511001488195900101317359943524530294761104636011049598534789403058853478839736557261093125245020396696912633025039855991126199499066137603816714976082728551303834703161541874435252675071181027233660
N = [n1, n2, n3]
c = [c1, c2, c3]


key = attack(N, e, c)
print(f"key: {key}")
```
get flag
```
#!/usr/local/bin/python

from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad

c1_hex = "5f8f397776c5e00dcf916677abcd4e7b5d1cdecc5db6d46cb27034ad510598f4b1467e78f22bc2014a83a70498c643496b577e225d9cb4cc6656d25f139869b9"
key_int = 8035409700898696054829075150348455058146936690994109063641494871507417052595596327532984457738590777349234405101639871891073512153709037836359345663670866136288216829217942164097757432956919186184345961651781080911025842312288332396550740993559891648513354946986748684497245065841814049072644942611194723916119441063263386379577070804675825212948096332708942019150822080828271666566071

key_bytes = key_int.to_bytes((key_int.bit_length() + 7) // 8, 'big')[:16]

c1_bytes = bytes.fromhex(c1_hex)

cipher = AES.new(key_bytes, AES.MODE_ECB)
decrypted = cipher.decrypt(c1_bytes)

flag = unpad(decrypted, AES.block_size)
print(flag.decode())

```


